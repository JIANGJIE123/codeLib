<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="lib/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="lib/dropload/dropload.css">
    <link rel="stylesheet" type="text/css" href="css/common.css">
</head>
<body>
<div class="container-fluid line">
    <div class="nv0 nv">
        <span class="back"><img src="imgs/back.png" width="16">返回</span>
    </div>
    <div class="nv" style="display: flex">
        <div class=" choose">
            <a role="button" href="#" id="choose">
                筛选<span class="caret"></span>
            </a>
        </div>
        <div class="choose">
            <a role="button" href="#" id="all">
                全部<span class="caret"></span>
            </a>
        </div>
        <div class="popup" id="choosePopup">
            <div class="popupChoose clearFloat">
                <p class="option">全部</p>
                <p class="option">按设备</p><p class="option">按时间</p><p class="option">按游戏</p>
                <p class="option">按运营商</p><p class="option">按商家</p><p class="option">按内容商</p>
                <p class="option">按代理商</p>
            </div>
            <div class="popupBtns">
                <input type="button" value="重置" id="chooseReset">
                <input type="button" value="确定" id="chooseBtn">
            </div>
        </div>
        <div class="popup" id="allPopup">
            <div class="popupChoose clearFloat" id="games">
                <p class="option" data-code="all">全部</p>
                <p class="option" data-code="0">四国坦克</p><p class="option" data-code="1">雷霆战车</p><p class="option" data-code="8">整蛊轮盘</p>
                <p class="option" data-code="3">致命骰子</p><p class="option" data-code="9">狼人杀</p>
            </div>
            <div class="popupBtns">
                <input type="button" value="重置" id="allReset">
                <input type="button" value="确定" id="allBtn">
            </div>
        </div>
    </div>
    </div>
    <div class="nv2 nv">
        <input type="text" id="calendar" data-options="{'type':'YYYY-MM-DD','beginYear':2010,'endYear':2088}" style="width:75px;height:19px;" value="">
            <span class="caret"></span>
        <p class="income money" style="display: inline-block"><span>查询结果：</span><span id="results">0</span>条</p>
    </div>
        <!--<p class="income money"><span>收入：</span><span>￥727.00</span></p>-->
        <!--<p class="speing money"><span>收入：</span><span>￥727.00</span></p>-->

    </div>

    <section class="content" id="bContent">
        <!--<div class="order">-->
            <!--<div class="orderL"><img src="imgs/head.png" width="40"></div>-->
            <!--<div class="orderM">-->
                <!--<p>10086设备<br/>2019-3-13 16:54:43</p>-->
            <!--</div>-->
            <!--<div class="orderR"><span class="orderNum">+0.02</span></div>-->
        <!--</div>-->

    </section>
<div>
    <a href="javacript:void(0);" style="width: 40px;height: 40px;border-radius: 50%;background: #cf9455;border: 1px solid #cf9455;display: block;position: fixed;
    bottom: 62px;right: 50px;z-index: 999;color: #fff;display: none" class="set_top">
        <span class="fa fa-chevron-up" aria-hidden="true" style="position: absolute;left: 50%; top: 46%;transform: translate(-50%,-50%);width: 30px">置顶</span>
    </a>
</div>
</div>



<script src="lib/jquery-3.3.1.min.js"></script>
<script src="lib/bootstrap/bootstrap.min.js"></script>
<script src="lib/jquery.cookie.js"></script>
<script type="text/javascript" src="lib/jquery.date.js"></script>
<script src="lib/dropload/dropload.min.js"></script>
<script src="js/common.js"></script>
<script type="text/javascript">
    $(function(){
        // $("#choose").click(function () {
        //     $('#allPopup').hide();
        //     if($('#choosePopup').is(':hidden')){//如果当前隐藏
        //         $('#choosePopup').show();
        //     }else{
        //         $('#choosePopup').hide();
        //     }
        //
        // });
        $("#all").click(function () {
            $('#choosePopup').hide();
            if($('#allPopup').is(':hidden')){//如果当前隐藏
                $('#allPopup').show();
            }else{
                $('#allPopup').hide();
            }

        });
        //日历
        function getNow(s) {
            return s < 10 ? '0' + s: s;
        };
        var myDate = new Date();
        var year=myDate.getFullYear();
        var month=myDate.getMonth()+1;
        var date=myDate.getDate();
        var now=year+'-'+getNow(month)+"-"+getNow(date);
        $("#calendar").val(now);
        // $.date('#calendar');

        //点击获得选项
        var option;
        var code;
        let token= $.cookie('token');
        let agencyId= $.cookie('agencyId');//商户ID，登录的时候返回的memberId
        let role= $.cookie('role');
        let isGameChoose=false;
        //分页获得订单信息
        let page = 0;    // 每页展示5个
        let size = 10;    // dropload调用

        //上拉加载
        function loadMore(){
            $('#bContent').dropload({
                scrollArea : window,
                domDown : {
                    domNoData  : '<p class="dropload-noData">暂无更多数据</p>'
                },
                loadDownFn : function(me){
                    page++;
                    console.log(role);
                    if(role==3){//经销商
                        console.log("isGameChoose:"+isGameChoose);
                        if(!isGameChoose){//全部
                            $.ajax({
                                headers: {
                                    "token": token
                                },
                                type: "get",
                                contentType: 'application/json;charset=UTF-8',
                                dataType: "json",
                                url: "https://game.hdiandian.com/agency/agencyManager/orders",
                                data:{
                                    "agencyId":agencyId,
                                    "current":page,
                                    "limit":size
                                },
                                success: function(data){
                                    console.log(data);
                                    let msg=data.data;
                                    if(msg){
                                        let orders=msg.page.records;
                                        $("#results").text(msg.page.total);
                                        for(let i=0;i<orders.length;i++){
                                            $("#bContent").append(`<div class="order">
                                    <div class="orderL"><img src=\"${orders[i].iconUrl}\" width="40"></div>
                                    <div class="orderM">
                                        <p>${orders[i].screenCode}设备<br/>${orders[i].createTime}</p>
                                    </div>
                                    <div class="orderR"><span class="orderNum">${orders[i].money/100}</span></div>
                                </div>`);
                                        };
                                        if(orders.length==0){me.lock();me.noData();}
                                    }else{
                                        me.lock();  // 锁定
                                        me.noData(); // 无数据
                                    };
                                    me.resetload();

                                },
                                error: function(xhr, type){
                                    // alert('Ajax error!');
                                    // 即使加载出错，也得重置
                                    console.log(xhr)
                                    me.lock();  // 锁定
                                    me.noData(); // 无数据
                                    me.resetload();
                                }
                            });
                        }else{//游戏筛选
                            console.log("游戏code:"+code);
                            $.ajax({
                                headers: {
                                    "token": token
                                },
                                type: "get",
                                contentType: 'application/json;charset=UTF-8',
                                dataType: "json",
                                url: "https://game.hdiandian.com/agency/agencyManager/orders",
                                data:{
                                    "agencyId":agencyId,
                                    "current":page,
                                    "limit":size,
                                    "gameCode":code
                                },
                                success: function(data){
                                    console.log(data);
                                    let msg=data.data;
                                    if(msg){
                                        let orders=msg.page.records;
                                        $("#results").text(msg.page.total);
                                        for(let i=0;i<orders.length;i++){
                                            $("#bContent").append(`<div class="order">
                                    <div class="orderL"><img src=\"${orders[i].iconUrl}\" width="40"></div>
                                    <div class="orderM">
                                        <p>${orders[i].screenCode}设备<br/>${orders[i].createTime}</p>
                                    </div>
                                    <div class="orderR"><span class="orderNum">${orders[i].money/100}</span></div>
                                </div>`);
                                        };
                                        if(orders.length==0){me.lock();me.noData();}
                                    }else{
                                        me.lock();  // 锁定
                                        me.noData(); // 无数据
                                    };
                                    me.resetload();

                                },
                                error: function(xhr, type){
                                    // alert('Ajax error!');
                                    // 即使加载出错，也得重置
                                    console.log(xhr)
                                    me.lock();  // 锁定
                                    me.noData(); // 无数据
                                    me.resetload();
                                }
                            });
                        }


                    };
                    if(role==2){//商家
                        if(!isGameChoose){ //游戏筛选
                            $.ajax({
                                headers: {
                                    "token": token
                                },
                                type: "get",
                                url: "https://game.hdiandian.com/agency/business/orders",
                                data:{
                                    "businessId":agencyId,
                                    "current":page,
                                    "limit":size
                                },
                                contentType: 'application/json;charset=UTF-8',
                                dataType: "json",
                                success: function(data){
                                    console.log(data);
                                    console.log("商家");
                                    let msg=data.data.page
                                    if(msg){
                                        let orders=msg.records;
                                        $("#results").text(msg.total);
                                        for(let i=0;i<orders.length;i++){
                                            $("#bContent").append(`<div class="order">
                                    <div class="orderL"><img src=\"${orders[i].iconUrl}\" width="40"></div>
                                    <div class="orderM">
                                        <p>${orders[i].screenCode}设备<br/>${orders[i].createTime}</p>
                                    </div>
                                    <div class="orderR"><span class="orderNum">${orders[i].money/100}</span></div>
                                </div>`);
                                        };
                                        if(orders.length==0){me.lock(); me.noData();}
                                    }else{
                                        $("#results").text(0);
                                        me.lock();  // 锁定
                                        me.noData(); // 无数据
                                    };
                                    me.resetload();
                                },
                                error: function(xhr, type){
                                    // alert('Ajax error!');
                                    // 即使加载出错，也得重置
                                    console.log(xhr)
                                    me.lock();  // 锁定
                                    me.noData(); // 无数据
                                    me.resetload();
                                }
                            });
                        }else{
                            $.ajax({
                                headers: {
                                    "token": token
                                },
                                type: "get",
                                url: "https://game.hdiandian.com/agency/business/orders",
                                data:{
                                    "businessId":agencyId,
                                    "current":page,
                                    "limit":size,
                                    "gameCode":code
                                },
                                contentType: 'application/json;charset=UTF-8',
                                dataType: "json",
                                success: function(data){
                                    console.log(data);
                                    console.log("商家");
                                    let msg=data.data.page;
                                    if(msg){
                                        let orders=msg.records;
                                        $("#results").text(msg.total);
                                        for(let i=0;i<orders.length;i++){
                                            $("#bContent").append(`<div class="order">
                                    <div class="orderL"><img src=\"${orders[i].iconUrl}\" width="40"></div>
                                    <div class="orderM">
                                        <p>${orders[i].screenCode}设备<br/>${orders[i].createTime}</p>
                                    </div>
                                    <div class="orderR"><span class="orderNum">${orders[i].money/100}</span></div>
                                </div>`);
                                        };
                                        if(orders.length==0){me.lock(); me.noData();}
                                    }else{
                                        $("#results").text(0);
                                        me.lock();  // 锁定
                                        me.noData(); // 无数据
                                    };
                                    me.resetload();
                                },
                                error: function(xhr, type){
                                    // alert('Ajax error!');
                                    // 即使加载出错，也得重置
                                    console.log(xhr)
                                    me.lock();  // 锁定
                                    me.noData(); // 无数据
                                    me.resetload();
                                }
                            });
                        };

                    };


                }
            });
        };
        loadMore();
//游戏筛选确定
        $(".option").click(function () {
            if($(this).hasClass("optionClick")){
                $(this).removeClass("optionClick");
            }else{
                $(".option").removeClass("optionClick");
                $(this).addClass("optionClick");
            }
            option=$(this).text();
            code=$(this).data("code");

        });
        $("#allBtn").click(function () {
            $('#allPopup').hide();
            $(".option").removeClass("optionClick");
            isGameChoose=true;
            console.log(code);
            if(code!=undefined){
                isGameChoose=true;
                page=0;
                $('#bContent').empty();
                console.log(option+":"+code );
                if(code=="all"){isGameChoose=false;};
                loadMore();
            };

        });
        //游戏筛选重置
        $("#allReset").click(function () {
            $(".option").removeClass("optionClick");
            option=undefined;
            code=undefined;
        });


        //下拉框重置
        $("#chooseReset").click(function () {
            $(".option").each(function () {
                if ($(this).hasClass("optionClick")){
                    $(this).removeClass("optionClick");
                };
            })
        });
        //下拉框确定
        $("#chooseBtn").click(function () {
            //清空数据
            //添加新数据
        });
        //时间发送后台
        $("#d-confirm").click(function () {

        });
    //返回首页
        $(".back").click(function () {
            if(role==3){
                window.location.href="indexAddM.html?memberId="+agencyId+"&token="+token+"&role="+role;
            };
            if(role==2){
                window.location.href="index.html?memberId="+agencyId+"&token="+token+"&role="+role;
            }
        })

        
    })



</script>
</body>
</html>